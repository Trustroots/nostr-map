{"mappings":"qhBAAA,IAAAA,EAAAC,EAAA,S,iECAAC,EAAAD,EAAA,S,4BAIO,MAAME,EAAuBC,UAElC,UADyB,EAAAC,EAAAC,iBAKzB,aACU,EAAAC,EAAAC,cACN,kGAUJC,EAAAP,GAAKQ,KAAK,CACRC,KAAM,0HARAF,EAAAP,GAAKQ,KAAK,CACdC,KAAM,iJAERC,WAAWC,SAASC,KAAO,oCAM7B,EDVqBV,WACrB,MAAMW,QAAmB,EAAAV,EAAAC,iBAERU,SAASC,eAAe,QAChCC,QAAWC,IAClBA,EAAMC,kBACN,EAAAC,EAAAC,oBAAgB,EAGlB,MAAMC,EAAWvB,EAAAwB,QAAUC,IAAI,YACzBC,EAAY1B,EAAAwB,QAAUC,IAAI,aAEhC,GAAIV,EAAY,CACdf,EAAAwB,QAAUG,SAASJ,EAAU,QAC7BvB,EAAAwB,QAAUG,SAASD,EAAW,QAERV,SAASC,eAAe,WAChCC,QAAUd,gBAChB,EAAAC,EAAAuB,mBACNhB,WAAWC,SAASgB,QAAM,QAGJ,EAAAxB,EAAAyB,gBAAxB,MACMC,QAAsB,EAAA1B,EAAA2B,oBACtBC,QAAuB,EAAA5B,EAAA6B,qBAEPtB,WAAWI,SAASC,eAAe,iBAC3CkB,UAAYJ,EAExBnB,WAAWI,SAASC,eAAe,kBAClBkB,UAAYF,CACjC,KAAO,CACLjC,EAAAwB,QAAUG,SAASJ,EAAU,QAC7BvB,EAAAwB,QAAUG,SAASD,EAAW,QAETV,SAASC,eAAe,UAChCC,QAAU,MACrB,EAAAkB,EAAAC,wBACA,EAAAhB,EAAAiB,sBAAkB,CAEtB,CAEA,MAAMC,EAAcvB,SAASC,eAAe,UACtCuB,QAAe,EAAAC,EAAAC,aACfC,EAAaC,KAAKC,UAAUL,GAClCD,EAAYO,MAAQH,EAEpB,MAAMI,EAAoB/B,SAASC,eAAe,iBAClD8B,EAAkB7B,QAAUd,MAAOe,IACjCA,EAAMC,iBACN2B,EAAkBC,aAAa,WAAY,YAE3C,MAAML,EAAaJ,EAAYO,MAC/B,IACE,MAAMG,EAAiBL,KAAKM,MAAMP,GAClC,IAAKQ,MAAMC,QAAQH,GAGjB,OAFAF,EAAkBM,gBAAgB,iBAClCzC,WAAW0C,MAAM,+CAGnB,MAAMd,EACsB,IAA1BS,EAAeM,OAAeC,EAAAC,eAAiBR,QAC3C,EAAAR,EAAAiB,WAAU,C,OAAElB,IAClB5B,WAAW0C,MAAM,iBACjB1C,WAAWI,SAASH,SAASgB,QAI/B,CAHE,MAAO8B,GACPZ,EAAkBM,gBAAgB,YAClCzC,WAAW0C,MAAM,gCAAgCK,EAAMC,aACzD,GAGFzD,GAAmB,EAErB0D","sources":["src/startup.ts","src/welcome.ts"],"sourcesContent":["import * as L from \"leaflet\";\nimport { DEFAULT_RELAYS } from \"./constants\";\nimport { hackSidePanelClosed, hackSidePanelOpen } from \"./map\";\nimport { getRelays, setRelays } from \"./nostr\";\nimport {\n  getNpubPublicKey,\n  getNsecPrivateKey,\n  getPublicKey,\n  hasPrivateKey,\n  unsetPrivateKey,\n} from \"./nostr/keys\";\nimport { startUserOnboarding } from \"./onboarding\";\nimport { startWelcomeSequence } from \"./welcome\";\n\nexport const startup = async () => {\n  const isLoggedIn = await hasPrivateKey();\n\n  const helpLink = document.getElementById(\"help\")!;\n  helpLink.onclick = (event) => {\n    event.preventDefault();\n    hackSidePanelOpen();\n  };\n\n  const loggedIn = L.DomUtil.get(\"loggedIn\")!;\n  const loggedOut = L.DomUtil.get(\"loggedOut\")!;\n\n  if (isLoggedIn) {\n    L.DomUtil.addClass(loggedIn, \"show\");\n    L.DomUtil.addClass(loggedOut, \"hide\");\n\n    const signoutButton = document.getElementById(\"signout\")!;\n    signoutButton.onclick = async () => {\n      await unsetPrivateKey();\n      globalThis.location.reload();\n    };\n\n    const publicKey = await getPublicKey();\n    const npubPublicKey = await getNpubPublicKey();\n    const nsecPrivateKey = await getNsecPrivateKey();\n\n    const publicKeyCode = globalThis.document.getElementById(\"npubPublicKey\")!;\n    publicKeyCode.innerText = npubPublicKey;\n    const nsecPrivateKeyCode =\n      globalThis.document.getElementById(\"nsecPrivateKey\")!;\n    nsecPrivateKeyCode.innerText = nsecPrivateKey;\n  } else {\n    L.DomUtil.addClass(loggedIn, \"hide\");\n    L.DomUtil.addClass(loggedOut, \"show\");\n\n    const signupButton = document.getElementById(\"signup\")!;\n    signupButton.onclick = () => {\n      startUserOnboarding();\n      hackSidePanelClosed();\n    };\n  }\n\n  const relaysInput = document.getElementById(\"relays\") as HTMLInputElement;\n  const relays = await getRelays();\n  const relaysJson = JSON.stringify(relays);\n  relaysInput.value = relaysJson;\n\n  const relaySubmitButton = document.getElementById(\"relays_submit\")!;\n  relaySubmitButton.onclick = async (event) => {\n    event.preventDefault();\n    relaySubmitButton.setAttribute(\"disabled\", \"disabled\");\n\n    const relaysJson = relaysInput.value;\n    try {\n      const relaysFromJson = JSON.parse(relaysJson) as string[];\n      if (!Array.isArray(relaysFromJson)) {\n        relaySubmitButton.removeAttribute(\"disabled\");\n        globalThis.alert(\"Invalid relays submitted. Please try again.\");\n        return;\n      }\n      const relays =\n        relaysFromJson.length === 0 ? DEFAULT_RELAYS : relaysFromJson;\n      await setRelays({ relays });\n      globalThis.alert(\"Relays saved.\");\n      globalThis.document.location.reload();\n    } catch (error) {\n      relaySubmitButton.removeAttribute(\"disabled\");\n      globalThis.alert(`#vRuf1N Error saving relays\\n${error.toString()}`);\n    }\n  };\n\n  startWelcomeSequence();\n};\nstartup();\n","import Swal from \"sweetalert2\";\nimport { hasPrivateKey } from \"./nostr/keys\";\nimport { confirmYesNo } from \"./utils\";\n\nexport const startWelcomeSequence = async () => {\n  const isLoggedIn = await hasPrivateKey();\n  if (isLoggedIn) {\n    return;\n  }\n\n  if (\n    !(await confirmYesNo(\n      `Notes is an experimental feature using an open developed protocol called NOSTR. Continue?`\n    ))\n  ) {\n    await Swal.fire({\n      text: `This will become more user friendly in the future. Feel free to come back anytime. Now we'll take you back to the main trustroots site.`,\n    });\n    globalThis.location.href = `http://www.trustroots.org/search`;\n    return;\n  }\n\n  Swal.fire({\n    text: `Great. Browse map to see other people's notes and right click (or long press on mobile) to add your own note. `,\n  });\n};\n"],"names":["$8JYDX","parcelRequire","$dcZZ4","$5671e7ef3fae0719$export$f3af3953777865d","async","$lsWS8","hasPrivateKey","$mDWTX","confirmYesNo","$parcel$interopDefault","fire","text","globalThis","location","href","isLoggedIn","document","getElementById","onclick","event","preventDefault","$dZENK","hackSidePanelOpen","loggedIn","DomUtil","get","loggedOut","addClass","unsetPrivateKey","reload","getPublicKey","npubPublicKey","getNpubPublicKey","nsecPrivateKey","getNsecPrivateKey","innerText","$dgphM","startUserOnboarding","hackSidePanelClosed","relaysInput","relays","$F1Hgz","getRelays","relaysJson","JSON","stringify","value","relaySubmitButton","setAttribute","relaysFromJson","parse","Array","isArray","removeAttribute","alert","length","$bNqR0","DEFAULT_RELAYS","setRelays","error","toString","$c68123b027adfc04$export$26a1f54597e2915b"],"version":3,"file":"index.b7e5cdfd.js.map"}