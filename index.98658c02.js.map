{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,S,0BCAAC,EAAAD,EAAA,SAEO,MAAME,EAAuBC,UAElC,UADyB,EAAAF,EAAAG,iBAKzB,OACGC,WAAWC,QACV,kEAQJD,WAAWE,MACT,mEANAF,WAAWE,MAAM,6DACjBF,WAAWG,SAASC,KAAO,oCAKqC,E,iBDH7CN,WACrB,MAAMO,QAAmB,EAAAT,EAAAG,iBAEnBO,EAAWZ,EAAAa,QAAUC,IAAI,YACzBC,EAAYf,EAAAa,QAAUC,IAAI,aAEhC,GAAIH,EAAY,CACdX,EAAAa,QAAUG,SAASJ,EAAU,QAC7BZ,EAAAa,QAAUG,SAASD,EAAW,QAERE,SAASC,eAAe,WAChCC,QAAUf,gBAChB,EAAAF,EAAAkB,mBACNd,WAAWG,SAASY,QAAM,QAGJ,EAAAnB,EAAAoB,gBAAxB,MACMC,QAAsB,EAAArB,EAAAsB,oBACtBC,QAAuB,EAAAvB,EAAAwB,qBAEPpB,WAAWW,SAASC,eAAe,iBAC3CS,UAAYJ,EAExBjB,WAAWW,SAASC,eAAe,kBAClBS,UAAYF,CACjC,KAAO,CACLzB,EAAAa,QAAUG,SAASJ,EAAU,QAC7BZ,EAAAa,QAAUG,SAASD,EAAW,QAETE,SAASC,eAAe,UAChCC,QAAU,MACrB,EAAAS,EAAAC,sBAAkB,CAEtB,CAEA,MAAMC,EAAcb,SAASC,eAAe,UACtCa,QAAe,EAAAC,EAAAC,aACfC,EAAaC,KAAKC,UAAUL,GAClCD,EAAYO,MAAQH,EAEpB,MAAMI,EAAoBrB,SAASC,eAAe,iBAClDoB,EAAkBnB,QAAUf,MAAOmC,IACjCA,EAAMC,iBACNF,EAAkBG,aAAa,WAAY,YAE3C,MAAMP,EAAaJ,EAAYO,MAC/B,IACE,MAAMN,EAASI,KAAKO,MAAMR,GAC1B,IAAKS,MAAMC,QAAQb,IAA6B,IAAlBA,EAAOc,OAGnC,OAFAP,EAAkBQ,gBAAgB,iBAClCxC,WAAWE,MAAM,qDAGb,EAAAwB,EAAAe,WAAU,C,OAAEhB,IAClBzB,WAAWE,MAAM,iBACjBF,WAAWW,SAASR,SAASY,QAI/B,CAHE,MAAO2B,GACPV,EAAkBQ,gBAAgB,YAClCxC,WAAWE,MAAM,gCAAgCwC,EAAMC,aACzD,GAGF9C,GAAmB,EAErB+C","sources":["src/startup.ts","src/welcome.ts"],"sourcesContent":["import * as L from \"leaflet\";\nimport { getRelays, setRelays } from \"./nostr\";\nimport {\n  createPrivateKey,\n  getNpubPublicKey,\n  getNsecPrivateKey,\n  getPublicKey,\n  hasPrivateKey,\n  setPrivateKey,\n  unsetPrivateKey,\n} from \"./nostr/keys\";\nimport { setProfile, subscribeAndGetProfile } from \"./nostr/profiles\";\nimport { getTrustrootsUsernameFromLocation } from \"./router\";\nimport { startWelcomeSequence } from \"./welcome\";\nimport { startUserOnboarding } from \"./onboarding\";\n\nexport const startup = async () => {\n  const isLoggedIn = await hasPrivateKey();\n\n  const loggedIn = L.DomUtil.get(\"loggedIn\")!;\n  const loggedOut = L.DomUtil.get(\"loggedOut\")!;\n\n  if (isLoggedIn) {\n    L.DomUtil.addClass(loggedIn, \"show\");\n    L.DomUtil.addClass(loggedOut, \"hide\");\n\n    const signoutButton = document.getElementById(\"signout\")!;\n    signoutButton.onclick = async () => {\n      await unsetPrivateKey();\n      globalThis.location.reload();\n    };\n\n    const publicKey = await getPublicKey();\n    const npubPublicKey = await getNpubPublicKey();\n    const nsecPrivateKey = await getNsecPrivateKey();\n\n    const publicKeyCode = globalThis.document.getElementById(\"npubPublicKey\")!;\n    publicKeyCode.innerText = npubPublicKey;\n    const nsecPrivateKeyCode =\n      globalThis.document.getElementById(\"nsecPrivateKey\")!;\n    nsecPrivateKeyCode.innerText = nsecPrivateKey;\n  } else {\n    L.DomUtil.addClass(loggedIn, \"hide\");\n    L.DomUtil.addClass(loggedOut, \"show\");\n\n    const signupButton = document.getElementById(\"signup\")!;\n    signupButton.onclick = () => {\n      startUserOnboarding();\n    };\n  }\n\n  const relaysInput = document.getElementById(\"relays\") as HTMLInputElement;\n  const relays = await getRelays();\n  const relaysJson = JSON.stringify(relays);\n  relaysInput.value = relaysJson;\n\n  const relaySubmitButton = document.getElementById(\"relays_submit\")!;\n  relaySubmitButton.onclick = async (event) => {\n    event.preventDefault();\n    relaySubmitButton.setAttribute(\"disabled\", \"disabled\");\n\n    const relaysJson = relaysInput.value;\n    try {\n      const relays = JSON.parse(relaysJson) as string[];\n      if (!Array.isArray(relays) || relays.length === 0) {\n        relaySubmitButton.removeAttribute(\"disabled\");\n        globalThis.alert(\"Invalid relays submitted. Please try again.\");\n        return;\n      }\n      await setRelays({ relays });\n      globalThis.alert(\"Relays saved.\");\n      globalThis.document.location.reload();\n    } catch (error) {\n      relaySubmitButton.removeAttribute(\"disabled\");\n      globalThis.alert(`#vRuf1N Error saving relays\\n${error.toString()}`);\n    }\n  };\n\n  startWelcomeSequence();\n};\nstartup();\n","import { hasPrivateKey } from \"./nostr/keys\";\n\nexport const startWelcomeSequence = async () => {\n  const isLoggedIn = await hasPrivateKey();\n  if (isLoggedIn) {\n    return;\n  }\n\n  if (\n    !globalThis.confirm(\n      \"Welcome. This is experimental. Are you ready to get wild?\"\n    )\n  ) {\n    globalThis.alert(`Then we'll take you back to the safety of trustroots`);\n    globalThis.location.href = `http://www.trustroots.org/search`;\n    return;\n  }\n\n  globalThis.alert(\n    `Right click if you want to add something to the map. Have fun.`\n  );\n};\n"],"names":["$8JYDX","parcelRequire","$lsWS8","$5671e7ef3fae0719$export$f3af3953777865d","async","hasPrivateKey","globalThis","confirm","alert","location","href","isLoggedIn","loggedIn","DomUtil","get","loggedOut","addClass","document","getElementById","onclick","unsetPrivateKey","reload","getPublicKey","npubPublicKey","getNpubPublicKey","nsecPrivateKey","getNsecPrivateKey","innerText","$dgphM","startUserOnboarding","relaysInput","relays","$F1Hgz","getRelays","relaysJson","JSON","stringify","value","relaySubmitButton","event","preventDefault","setAttribute","parse","Array","isArray","length","removeAttribute","setRelays","error","toString","$c68123b027adfc04$export$26a1f54597e2915b"],"version":3,"file":"index.98658c02.js.map"}