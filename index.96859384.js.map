{"mappings":"qhBAAA,IAAAA,EAAAC,EAAA,S,oDCAAC,EAAAD,EAAA,S,4BAIO,MAAME,EAAuBC,UAElC,UADyB,EAAAC,EAAAC,iBAKzB,aACU,EAAAC,EAAAC,cACN,kGAUJC,EAAAP,GAAKQ,KAAK,CACRC,KAAM,0HARAF,EAAAP,GAAKQ,KAAK,CACdC,KAAM,iJAERC,WAAWC,SAASC,KAAO,oCAM7B,E,iBDLqBV,WACrB,MAAMW,QAAmB,EAAAV,EAAAC,iBAERU,SAASC,eAAe,QAChCC,QAAWC,IAClBA,EAAMC,kBACN,EAAAC,EAAAC,oBAAgB,EAGlB,MAAMC,EAAcP,SAASC,eAAe,YACxB,OAAhBM,IACFA,EAAYC,YAAW,4CAGzB,MAAMC,EAAWzB,EAAA0B,QAAUC,IAAI,YACzBC,EAAY5B,EAAA0B,QAAUC,IAAI,aAEhC,GAAIZ,EAAY,CACdf,EAAA0B,QAAUG,SAASJ,EAAU,QAC7BzB,EAAA0B,QAAUG,SAASD,EAAW,QAERZ,SAASC,eAAe,WAChCC,QAAUd,gBAChB,EAAAC,EAAAyB,mBACNlB,WAAWC,SAASkB,QAAM,QAGJ,EAAA1B,EAAA2B,gBAAxB,MACMC,QAAsB,EAAA5B,EAAA6B,oBACtBC,QAAuB,EAAA9B,EAAA+B,qBAEvBC,EAAgBzB,WAAWI,SAASC,eAAe,iBACnDqB,EAAOtB,SAASuB,cAAc,KACpCD,EAAKxB,KAAO,oBAAoBmB,IAChCK,EAAKE,OAAS,SACdF,EAAKG,UAAYR,EACjBI,EAAcK,YAAYJ,GAExB1B,WAAWI,SAASC,eAAe,kBAClBwB,UAAYN,CACjC,KAAO,CACLnC,EAAA0B,QAAUG,SAASJ,EAAU,QAC7BzB,EAAA0B,QAAUG,SAASD,EAAW,QAETZ,SAASC,eAAe,UAChCC,QAAU,MACrB,EAAAyB,EAAAC,wBACA,EAAAvB,EAAAwB,sBAAkB,CAEtB,CAEA,MAAMC,EAAc9B,SAASC,eAAe,UACtC8B,QAAe,EAAAC,EAAAC,aACfC,EAAaC,KAAKC,UAAUL,GAClCD,EAAYO,MAAQH,EAEpB,MAAMI,EAAoBtC,SAASC,eAAe,iBAClDqC,EAAkBpC,QAAUd,MAAOe,IACjCA,EAAMC,iBACNkC,EAAkBC,aAAa,WAAY,YAE3C,MAAML,EAAaJ,EAAYO,MAC/B,IACE,MAAMG,EAAiBL,KAAKM,MAAMP,GAClC,IAAKQ,MAAMC,QAAQH,GAGjB,OAFAF,EAAkBM,gBAAgB,iBAClChD,WAAWiD,MAAM,+CAGnB,MAAMd,EACsB,IAA1BS,EAAeM,QAAe,EAAAC,EAAAC,oBAAqBR,QAC/C,EAAAR,EAAAiB,WAAU,C,OAAElB,IAClBnC,WAAWiD,MAAM,iBACjBjD,WAAWI,SAASH,SAASkB,QAI/B,CAHE,MAAOmC,GACPZ,EAAkBM,gBAAgB,YAClChD,WAAWiD,MAAM,gCAAgCK,EAAMC,aACzD,GAGFhE,GAAmB,EAErBiE","sources":["src/startup.ts","src/welcome.ts"],"sourcesContent":["import * as L from \"leaflet\";\nimport { DEFAULT_RELAYS } from \"./constants\";\nimport { hackSidePanelClosed, hackSidePanelOpen } from \"./map\";\nimport { getRelays, setRelays } from \"./nostr\";\nimport {\n  getNpubPublicKey,\n  getNsecPrivateKey,\n  getPublicKey,\n  hasPrivateKey,\n  unsetPrivateKey,\n} from \"./nostr/keys\";\nimport { startUserOnboarding } from \"./onboarding\";\nimport { startWelcomeSequence } from \"./welcome\";\nimport { getDefaultRelays } from \"./nostr/relays\";\n\n// This is supported by parcel, our build system, but not recognised by\n// typescript, so we declare it here so that we can use it below.\ndeclare const process;\n\nexport const startup = async () => {\n  const isLoggedIn = await hasPrivateKey();\n\n  const helpLink = document.getElementById(\"help\")!;\n  helpLink.onclick = (event) => {\n    event.preventDefault();\n    hackSidePanelOpen();\n  };\n\n  const buildIdSpan = document.getElementById(\"build-id\");\n  if (buildIdSpan !== null) {\n    buildIdSpan.textContent = process.env.GITHUB_SHA || \"dev\";\n  }\n\n  const loggedIn = L.DomUtil.get(\"loggedIn\")!;\n  const loggedOut = L.DomUtil.get(\"loggedOut\")!;\n\n  if (isLoggedIn) {\n    L.DomUtil.addClass(loggedIn, \"show\");\n    L.DomUtil.addClass(loggedOut, \"hide\");\n\n    const signoutButton = document.getElementById(\"signout\")!;\n    signoutButton.onclick = async () => {\n      await unsetPrivateKey();\n      globalThis.location.reload();\n    };\n\n    const publicKey = await getPublicKey();\n    const npubPublicKey = await getNpubPublicKey();\n    const nsecPrivateKey = await getNsecPrivateKey();\n\n    const publicKeyCode = globalThis.document.getElementById(\"npubPublicKey\")!;\n    const link = document.createElement(\"a\");\n    link.href = `https://njump.me/${npubPublicKey}`;\n    link.target = \"_blank\";\n    link.innerText = npubPublicKey;\n    publicKeyCode.appendChild(link);\n    const nsecPrivateKeyCode =\n      globalThis.document.getElementById(\"nsecPrivateKey\")!;\n    nsecPrivateKeyCode.innerText = nsecPrivateKey;\n  } else {\n    L.DomUtil.addClass(loggedIn, \"hide\");\n    L.DomUtil.addClass(loggedOut, \"show\");\n\n    const signupButton = document.getElementById(\"signup\")!;\n    signupButton.onclick = () => {\n      startUserOnboarding();\n      hackSidePanelClosed();\n    };\n  }\n\n  const relaysInput = document.getElementById(\"relays\") as HTMLInputElement;\n  const relays = await getRelays();\n  const relaysJson = JSON.stringify(relays);\n  relaysInput.value = relaysJson;\n\n  const relaySubmitButton = document.getElementById(\"relays_submit\")!;\n  relaySubmitButton.onclick = async (event) => {\n    event.preventDefault();\n    relaySubmitButton.setAttribute(\"disabled\", \"disabled\");\n\n    const relaysJson = relaysInput.value;\n    try {\n      const relaysFromJson = JSON.parse(relaysJson) as string[];\n      if (!Array.isArray(relaysFromJson)) {\n        relaySubmitButton.removeAttribute(\"disabled\");\n        globalThis.alert(\"Invalid relays submitted. Please try again.\");\n        return;\n      }\n      const relays =\n        relaysFromJson.length === 0 ? getDefaultRelays() : relaysFromJson;\n      await setRelays({ relays });\n      globalThis.alert(\"Relays saved.\");\n      globalThis.document.location.reload();\n    } catch (error) {\n      relaySubmitButton.removeAttribute(\"disabled\");\n      globalThis.alert(`#vRuf1N Error saving relays\\n${error.toString()}`);\n    }\n  };\n\n  startWelcomeSequence();\n};\nstartup();\n","import Swal from \"sweetalert2\";\nimport { hasPrivateKey } from \"./nostr/keys\";\nimport { confirmYesNo } from \"./utils\";\n\nexport const startWelcomeSequence = async () => {\n  const isLoggedIn = await hasPrivateKey();\n  if (isLoggedIn) {\n    return;\n  }\n\n  if (\n    !(await confirmYesNo(\n      `Notes is an experimental feature using an open developed protocol called NOSTR. Continue?`\n    ))\n  ) {\n    await Swal.fire({\n      text: `This will become more user friendly in the future. Feel free to come back anytime. Now we'll take you back to the main trustroots site.`,\n    });\n    globalThis.location.href = `http://www.trustroots.org/search`;\n    return;\n  }\n\n  Swal.fire({\n    text: `Great. Browse map to see other people's notes and right click (or long press on mobile) to add your own note. `,\n  });\n};\n"],"names":["$8JYDX","parcelRequire","$dcZZ4","$5671e7ef3fae0719$export$f3af3953777865d","async","$lsWS8","hasPrivateKey","$mDWTX","confirmYesNo","$parcel$interopDefault","fire","text","globalThis","location","href","isLoggedIn","document","getElementById","onclick","event","preventDefault","$dZENK","hackSidePanelOpen","buildIdSpan","textContent","loggedIn","DomUtil","get","loggedOut","addClass","unsetPrivateKey","reload","getPublicKey","npubPublicKey","getNpubPublicKey","nsecPrivateKey","getNsecPrivateKey","publicKeyCode","link","createElement","target","innerText","appendChild","$dgphM","startUserOnboarding","hackSidePanelClosed","relaysInput","relays","$F1Hgz","getRelays","relaysJson","JSON","stringify","value","relaySubmitButton","setAttribute","relaysFromJson","parse","Array","isArray","removeAttribute","alert","length","$jktzu","getDefaultRelays","setRelays","error","toString","$c68123b027adfc04$export$26a1f54597e2915b"],"version":3,"file":"index.96859384.js.map"}