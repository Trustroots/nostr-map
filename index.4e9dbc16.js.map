{"mappings":"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","sources":["src/startup.ts","src/router.ts","src/welcome.ts"],"sourcesContent":["import * as L from \"leaflet\";\nimport { getRelays, setRelays } from \"./nostr\";\nimport {\n  createPrivateKey,\n  getNpubPublicKey,\n  getNsecPrivateKey,\n  getPublicKey,\n  hasPrivateKey,\n  setPrivateKey,\n} from \"./nostr/keys\";\nimport { setProfile, subscribeAndGetProfile } from \"./nostr/profiles\";\nimport { getTrustrootsUsernameFromLocation } from \"./router\";\nimport { startWelcomeSequence } from \"./welcome\";\n\nexport const startup = async () => {\n  const isLoggedIn = await hasPrivateKey();\n\n  const loggedIn = L.DomUtil.get(\"loggedIn\")!;\n  const loggedOut = L.DomUtil.get(\"loggedOut\")!;\n\n  if (isLoggedIn) {\n    L.DomUtil.addClass(loggedIn, \"show\");\n    L.DomUtil.addClass(loggedOut, \"hide\");\n\n    const publicKey = await getPublicKey();\n    const npubPublicKey = await getNpubPublicKey();\n    const nsecPrivateKey = await getNsecPrivateKey();\n\n    const publicKeyCode = globalThis.document.getElementById(\"npubPublicKey\")!;\n    publicKeyCode.innerText = npubPublicKey;\n    const nsecPrivateKeyCode =\n      globalThis.document.getElementById(\"nsecPrivateKey\")!;\n    nsecPrivateKeyCode.innerText = nsecPrivateKey;\n\n    const profileNameInput = document.getElementById(\n      \"profile_name\"\n    ) as HTMLInputElement;\n    const profileAboutInput = document.getElementById(\n      \"profile_about\"\n    ) as HTMLInputElement;\n    const profile = await subscribeAndGetProfile({ publicKey });\n    profileNameInput.value = profile.name;\n    profileAboutInput.value = profile.about;\n\n    const profileSubmitButton = document.getElementById(\"profile_submit\")!;\n    profileSubmitButton.onclick = async (event) => {\n      event.preventDefault();\n      profileSubmitButton.setAttribute(\"disabled\", \"disabled\");\n\n      const name = profileNameInput.value;\n      const about = profileAboutInput.value;\n      const trustrootsUsername = getTrustrootsUsernameFromLocation();\n\n      try {\n        await setProfile({ name, about, trustrootsUsername });\n\n        globalThis.alert(\"Your profile was updated.\");\n        globalThis.document.location.reload();\n      } catch {\n        globalThis.alert(\"There was an error. Please try again.\");\n        profileSubmitButton.removeAttribute(\"disabled\");\n      }\n    };\n  } else {\n    L.DomUtil.addClass(loggedIn, \"hide\");\n    L.DomUtil.addClass(loggedOut, \"show\");\n\n    const signupSubmit = document.getElementById(\"signup_submit\")!;\n    signupSubmit.onclick = async (event) => {\n      event.preventDefault();\n      signupSubmit.setAttribute(\"disabled\", \"disabled\");\n      const name = (document.getElementById(\"signup_name\") as HTMLInputElement)\n        .value;\n      const about = (\n        document.getElementById(\"signup_about\") as HTMLInputElement\n      ).value;\n\n      try {\n        await createPrivateKey();\n        const trustrootsUsername = getTrustrootsUsernameFromLocation();\n        setProfile({ name, about, trustrootsUsername }).then(() => {\n          globalThis.alert(\"Your account was created.\");\n          globalThis.document.location.reload();\n        });\n      } catch {\n        signinSubmit.removeAttribute(\"disabled\");\n      }\n    };\n\n    const signinSubmit = document.getElementById(\"signin_submit\")!;\n    signinSubmit.onclick = async (event) => {\n      event.preventDefault();\n      signupSubmit.setAttribute(\"disabled\", \"disabled\");\n      const privateKey = (\n        document.getElementById(\"signin_privateKey\") as HTMLInputElement\n      ).value;\n\n      try {\n        setPrivateKey({ privateKey });\n        globalThis.alert(\"You were signed in successfully.\");\n        globalThis.document.location.reload();\n      } catch {\n        signinSubmit.removeAttribute(\"disabled\");\n      }\n    };\n  }\n\n  const relaysInput = document.getElementById(\"relays\") as HTMLInputElement;\n  const relays = await getRelays();\n  const relaysJson = JSON.stringify(relays);\n  relaysInput.value = relaysJson;\n\n  const relaySubmitButton = document.getElementById(\"relays_submit\")!;\n  relaySubmitButton.onclick = async (event) => {\n    event.preventDefault();\n    relaySubmitButton.setAttribute(\"disabled\", \"disabled\");\n\n    const relaysJson = relaysInput.value;\n    try {\n      const relays = JSON.parse(relaysJson) as string[];\n      if (!Array.isArray(relays) || relays.length === 0) {\n        relaySubmitButton.removeAttribute(\"disabled\");\n        globalThis.alert(\"Invalid relays submitted. Please try again.\");\n        return;\n      }\n      await setRelays({ relays });\n      globalThis.alert(\"Relays saved.\");\n      globalThis.document.location.reload();\n    } catch (error) {\n      relaySubmitButton.removeAttribute(\"disabled\");\n      globalThis.alert(`#vRuf1N Error saving relays\\n${error.toString()}`);\n    }\n  };\n\n  startWelcomeSequence();\n};\nstartup();\n","import { nip19 } from \"nostr-tools\";\n\nexport const getTrustrootsUsernameFromLocation = ({\n  location = globalThis.document.location,\n}: {\n  location?: Location;\n} = {}): string => {\n  const { hash } = location;\n  const params = hash.split(\"=\"); // /#user={user}\n  if (typeof params[1] === \"string\") {\n    const username = params[1];\n    const sanitisedUsername = encodeURIComponent(username);\n    return sanitisedUsername;\n  }\n  return \"\";\n};\n","export const startWelcomeSequence = () => {\n  if (\n    !globalThis.confirm(\n      \"Welcome. This is experimental. Are you ready to get wild?\"\n    )\n  ) {\n    globalThis.alert(`Then we'll take you back to the safety of trustroots`);\n    globalThis.location.href = `http://www.trustroots.org/search`;\n    return;\n  }\n\n  globalThis.alert(\n    `Right click if you want to add something to the map. Have fun.`\n  );\n};\n"],"names":["$8JYDX","parcelRequire","$e817d3341cf3ea9c$export$246a669a046084a4","location","globalThis","document","hash","params","split","username","encodeURIComponent","$5671e7ef3fae0719$export$f3af3953777865d","confirm","alert","href","async","isLoggedIn","$lsWS8","hasPrivateKey","loggedIn","DomUtil","get","loggedOut","addClass","publicKey","getPublicKey","npubPublicKey","getNpubPublicKey","nsecPrivateKey","getNsecPrivateKey","getElementById","innerText","profileNameInput","profileAboutInput","profile","$8JDfT","subscribeAndGetProfile","value","name","about","profileSubmitButton","onclick","event","preventDefault","setAttribute","trustrootsUsername","setProfile","reload","removeAttribute","signupSubmit","createPrivateKey","then","signinSubmit","privateKey","setPrivateKey","relaysInput","relays","$F1Hgz","getRelays","relaysJson","JSON","stringify","relaySubmitButton","parse","Array","isArray","length","setRelays","error","toString","$c68123b027adfc04$export$26a1f54597e2915b"],"version":3,"file":"index.4e9dbc16.js.map"}